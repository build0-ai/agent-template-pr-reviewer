{
  "name": "Security Review Agent",
  "target_repo": {
    "url_env": "TARGET_REPO_URL"
  },
  "steps": [
    {
      "id": "clone_repo",
      "type": "system",
      "action": "clone",
      "path": "./workspace"
    },
    {
      "id": "analyze_code",
      "type": "claude_code",
      "prompt": "Run a security analysis on the codebase. Look for hardcoded secrets and potential SQL injection points. Create a report.",
      "working_dir": "./workspace"
    },
    {
      "id": "fix_issues",
      "type": "claude_code",
      "prompt": "If any critical issues were found, fix them. Create a new branch 'security-fix', commit the changes, and push.",
      "working_dir": "./workspace",
      "if": "{{ analyze_code.output.has_issues }}"
    },
    {
      "id": "create_pr",
      "type": "tool",
      "tool": "github_create_pr",
      "args": {
        "title": "Security Fixes",
        "body": "Automated security fixes generated by agent.",
        "head": "security-fix",
        "base": "main"
      },
      "if": "{{ analyze_code.output.has_issues }}"
    }
  ]
}

